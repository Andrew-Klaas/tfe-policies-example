import "tfplan"

allowed_machine_types = [
	"n1-standard-1",
	"n1-standard-2",
	"n1-standard-4",
]

machine_type_allowed = rule {
	all (tfplan.resources.google_compute_instance else {}) as _name, instances {
		all instances as _count, r {
			r.applied.machine_type in allowed_machine_types
		}
	}
}

main = rule {
	(machine_type_allowed) else true
}